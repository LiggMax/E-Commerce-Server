<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ligg.common.mapper.UserMapper">

    <!-- 更新用户信息 -->
    <update id="updateUserInfo">
        update user
        <set>
            <if test="nickName != null and nickName != ''">
                nick_name = #{nickName},
            </if>
            <if test="password != null and password != ''">
                password = #{password},
            </if>
            <if test="email != null and email != ''">
                email = #{email},
            </if>
            <if test="avatar != null and avatar != ''">
                avatar = #{avatar},
            </if>
        </set>
        where user_id = #{userId}
    </update>

    <update id="updateUserInfoByEmail">
        update user
        <set>
            <if test="nickName != null and nickName != ''">
                nick_name = #{nickName},
            </if>
            <if test="password != null and password != ''">
                password = #{password},
            </if>
            <if test="email != null and email != ''">
                email = #{email},
            </if>
            <if test="avatar != null and avatar != ''">
                avatar = #{avatar},
            </if>
            <if test="updateTime != null and updateTime != ''">
                update_time = #{updateTime},
            </if>
        </set>
        where email = #{email}
    </update>

    <!--根据商品id和用户id查询商品收藏信息-->
    <select id="selectUserFavorite" resultType="com.ligg.common.module.vo.FavoriteVo">
        select p.id as productId,
               p.title,
               p.image_path,
               p.original_price,
               p.current_price,
               p.rating,
               p.stock,
               p.views
        from product_favorite pf
                 left join product p on pf.product_id = p.id
        where pf.user_id = #{userId}
    </select>
</mapper>
